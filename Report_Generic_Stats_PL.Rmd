---
title: "Daily Report Premier League"
author: "Michele OREFICE"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
output: 
  html_document:
    css: "css/custom_style.css"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(readr)
library(dplyr)
library(tidyr)
library(ggrepel)
library(htmltools)

source(file.path(script_dir, "functions_library", "prepare_data.R"))    # Funci√≥nes para manpular datos
source(file.path(script_dir, "functions_library", "prepare_plots.R"))   # Funci√≥nes para generar graficos

team_stats <- read_csv("cleaned_team_overall_data.csv")
team_stats <- assign_badge_code(team_stats, "Premier League")
team_stats$badge_image <- paste("./badges/eng/",team_stats$badge_code ,".png",sep="")
cleaned_team_possession <- read_csv("cleaned_team_possession.csv")

# Definir la ruta del banner de la Premier League
banner_path <- file.path(script_dir, "badges", "eng", "Premier_League_Banner.png")

```

<div id="background-container"></div>

<div id="report-content">

```{r banner, echo=FALSE, out.width="100%", fig.align="center"}
knitr::include_graphics(banner_path)
```

# An√°lisis de Desempe√±o de Equipos en la Premier League 2024/2025

En este informe se realizar√° un an√°lisis detallado del desempe√±o de los equipos de la Premier League 2024/2025, centrado en dos aspectos fundamentales: la **eficiencia ofensiva** y la **eficiencia defensiva**. Para ello, se emplear√°n m√©tricas avanzadas como los **goles esperados (xG)** y los **goles esperados contra (xGA)**. Estas m√©tricas proporcionan una visi√≥n m√°s precisa y matizada de las capacidades de los equipos, m√°s all√° de los simples goles anotados o concedidos.

## Objetivo del Informe

El objetivo principal de este an√°lisis es explorar c√≥mo las m√©tricas de xG y xGA se relacionan con el rendimiento real de los equipos, identificando patrones en su capacidad ofensiva y defensiva. Adem√°s, se busca identificar aquellos equipos que est√°n destacando tanto por su capacidad para generar oportunidades de gol como por su capacidad para prevenir goles, as√≠ como aquellos equipos que est√°n sobre- o sub-performando respecto a sus expectativas.

## Metodolog√≠a

Para llevar a cabo este an√°lisis, se han utilizado las siguientes m√©tricas y enfoques:

-   **xG (Expected Goals)**: Mide la cantidad de goles esperados a partir de las oportunidades de gol generadas por un equipo. Este valor tiene en cuenta factores como la posici√≥n de tiro, el tipo de jugada y la dificultad del disparo.

-   **xGA (Expected Goals Against)**: Mide la cantidad de goles que un equipo deber√≠a haber concedido, basado en las oportunidades de gol que su defensa ha permitido.

-   **Puntos por partido (PPG)**: Representa el rendimiento de un equipo en t√©rminos de puntos obtenidos por partido.

El informe se centra en analizar la relaci√≥n entre estas m√©tricas, utilizando gr√°ficos y estad√≠sticas para proporcionar una visi√≥n clara de las tendencias y patrones que surgen durante la temporada.

## Estructura del Informe

A lo largo del informe, se presentar√°n diferentes gr√°ficos que muestran las relaciones entre estas m√©tricas. En particular, se destacan dos visualizaciones clave:

1.  **Relaci√≥n entre Goles Anotados (GF) y Goles Esperados (xG)**: Este gr√°fico analiza c√≥mo los equipos est√°n maximizando su capacidad ofensiva.

2.  **Relaci√≥n entre Goles Esperados (xG) y Puntos por Partido (PPG)**: Este gr√°fico examina el desempe√±o global de los equipos en funci√≥n de su capacidad para generar goles y ganar partidos.

Adem√°s, se discutir√°n las implicaciones de los resultados obtenidos, proporcionando conclusiones sobre qu√© equipos est√°n destacando por encima o por debajo de lo esperado.

## Prop√≥sito del An√°lisis

El prop√≥sito de este an√°lisis es proporcionar una comprensi√≥n m√°s profunda de las din√°micas de la Premier League, ayudando a los analistas, entrenadores y aficionados a comprender mejor los aspectos fundamentales que afectan el rendimiento de los equipos. Adem√°s, se intentar√° identificar posibles √°reas de mejora y destacar aquellos equipos que est√°n demostrando un rendimiento excepcional, ya sea ofensiva o defensivamente.

------------------------------------------------------------------------

## Relaci√≥n entre Goles Anotados y Goles Esperados (xG)

En este gr√°fico se visualiza la relaci√≥n entre los goles anotados (`gf`) y los goles esperados (`xG`) para los equipos de la Premier League. Se incluye una **l√≠nea de regresi√≥n lineal**, que facilita la identificaci√≥n de patrones en los datos y proporciona una visualizaci√≥n clara de la relaci√≥n entre las dos m√©tricas.

### Interpretaci√≥n del gr√°fico:

-   **L√≠nea de regresi√≥n**: La l√≠nea azul representa la tendencia central entre los goles anotados y los goles esperados. Esta l√≠nea permite observar c√≥mo, en promedio, los goles anotados deber√≠an correlacionarse con los goles esperados para cada equipo. Si un equipo se encuentra por encima de esta l√≠nea, esto indica que est√° anotando m√°s goles de los que se esperaban seg√∫n su rendimiento ofensivo (lo que implica una "sobresalida" en la eficiencia ofensiva). Por el contrario, si un equipo est√° por debajo de la l√≠nea, significa que no est√° aprovechando tanto sus oportunidades.

-   **Correlaci√≥n**: La **correlaci√≥n de 0.89** indica una relaci√≥n fuerte y positiva entre los goles anotados y los goles esperados. Esto sugiere que, en general, los equipos tienden a anotar una cantidad de goles cercana a la cantidad de goles esperados seg√∫n sus estad√≠sticas de xG. Este valor de correlaci√≥n muestra que las m√©tricas de goles esperados son un buen predictor de los goles anotados para la mayor√≠a de los equipos.

### An√°lisis:

-   **Equipos con alta eficiencia ofensiva**: Los equipos que est√°n por encima de la l√≠nea de regresi√≥n y se encuentran en la parte superior derecha del gr√°fico (es decir, anotando m√°s goles de los que se esperaban) son considerados como equipos con una **alta eficiencia ofensiva**. Estos equipos son capaces de maximizar las oportunidades de gol que crean y convertirlas con √©xito.

-   **Equipos ineficaces**: Los equipos situados en la parte inferior derecha, que anotan menos goles de los que se esperaban seg√∫n su xG, podr√≠an ser considerados **ineficaces en la finalizaci√≥n** o que dependen en exceso de factores aleatorios. Estos equipos podr√≠an estar perdiendo oportunidades claras de marcar, lo que afecta su rendimiento general.

-   **Equipos con bajo rendimiento ofensivo**: Aquellos equipos que se encuentran en la parte inferior izquierda del gr√°fico, debajo de la l√≠nea de regresi√≥n, podr√≠an estar luchando por generar oportunidades de gol de alta calidad. Esto podr√≠a deberse a una estrategia defensiva s√≥lida pero una falta de poder ofensivo para aprovechar sus oportunidades.

```{r goles_vs_xG, echo=FALSE, fig.width=15, fig.height=10, message=FALSE}
# Calcular la correlaci√≥n entre los goles anotados (gf) y los goles esperados (xG)
cor_value <- cor(team_stats$x_g, team_stats$gf)

# Crear el gr√°fico de dispersi√≥n con una l√≠nea de regresi√≥n lineal
ggplot(team_stats, aes(x = x_g, y = gf)) +
  # A√±adir la l√≠nea de regresi√≥n lineal
  geom_smooth(method = "lm", col = "blue") +  # L√≠nea de regresi√≥n
  # A√±adir los logos de los equipos
  geom_image(aes(image = badge_image), size = 0.14) +  # Logos de los equipos
  # T√≠tulos y etiquetas para los ejes
  labs(title = "Relaci√≥n entre Expected Goals (xG) y Goles Anotados", 
       x = "Goles Esperados (xG)", y = "Goles Anotados") +
  # A√±adir la correlaci√≥n en la esquina superior izquierda
  annotate("text", x = min(team_stats$x_g) + 0.5, y = max(team_stats$gf) - 2, 
           label = paste("Correlaci√≥n:", round(cor_value, 2)), 
           color = "red", size = 5, fontface = "bold", hjust = 0) +  # Correlaci√≥n entre xG y goles
  # Tema minimalista
  theme_minimal()

```

### Conclusiones:

El an√°lisis de la relaci√≥n entre goles anotados y goles esperados (xG) permite evaluar la eficiencia ofensiva de los equipos de la Premier League. La alta correlaci√≥n (0.89) entre ambas m√©tricas indica que, en la mayor√≠a de los casos, los equipos anotan una cantidad de goles cercana a la esperada, validando el xG como un predictor confiable del rendimiento ofensivo.

Los equipos por encima de la l√≠nea de regresi√≥n destacan por su gran capacidad de finalizaci√≥n, convirtiendo m√°s goles de lo esperado y demostrando una alta eficiencia ofensiva. En contraste, los equipos por debajo de la l√≠nea pueden estar desperdiciando oportunidades claras, lo que indica una ineficacia en la finalizaci√≥n o dependencia de factores externos como decisiones arbitrales o rendimiento de los porteros rivales.

Adem√°s, aquellos equipos ubicados en la parte inferior izquierda no solo anotan menos de lo esperado, sino que tambi√©n generan pocas oportunidades, lo que refleja un problema estructural en su ataque.

Este an√°lisis es clave para detectar tendencias en la finalizaci√≥n de los equipos y prever ajustes t√°cticos necesarios para mejorar su desempe√±o en lo que resta de la temporada.

------------------------------------------------------------------------

## xG vs Puntos por Partido

En este gr√°fico se presenta la relaci√≥n entre los **Goles Esperados (xG)** y los **Puntos por Partido (PPG)** para cada equipo de la Premier League en la temporada 2024/25. Este gr√°fico nos ayuda a identificar qu√© equipos est√°n superando las expectativas en t√©rminos de rendimiento ofensivo y defensivo, y cu√°les est√°n teniendo dificultades para transformar sus oportunidades en puntos.

### Explicaci√≥n de las m√©tricas:

-   **xG (Goles Esperados)**: Mide la calidad de las oportunidades de gol que un equipo ha generado a lo largo de la temporada. Un valor alto de xG indica que el equipo ha creado muchas oportunidades de gol de alta calidad.

-   **PPG (Puntos por Partido)**: Mide el n√∫mero de puntos que un equipo ha ganado por partido en promedio. Se calcula dividiendo los puntos totales obtenidos entre los partidos jugados.

### C√≥mo leer el gr√°fico:

El gr√°fico est√° dividido en **4 cuadrantes**, determinados por las medias de **xG** y **PPG** para todos los equipos:

1.  **Cuadrante Superior Derecho (üî• Equipos Dominantes)**:
    -   Equipos en este cuadrante tienen **alto xG** y **alto PPG**. Estos equipos est√°n generando muchas oportunidades de gol y tambi√©n logrando convertir esas oportunidades en puntos. Son equipos efectivos en ataque y defensa, y generalmente est√°n entre los primeros en la clasificaci√≥n.
2.  **Cuadrante Superior Izquierdo (‚öΩÔ∏è Sobrerendimiento Defensivo)**:
    -   Los equipos en este cuadrante tienen un **bajo xG** pero han obtenido m√°s puntos de lo esperado (**alto PPG**). Esto indica que son equipos que probablemente han sido muy eficientes en defensa y han logrado obtener m√°s puntos de los que su rendimiento ofensivo sugiere. Estos equipos pueden haber tenido suerte en los partidos o haberse beneficiado de un buen sistema defensivo.
3.  **Cuadrante Inferior Derecho (‚ùå Ineficacia Ofensiva)**:
    -   Los equipos en este cuadrante tienen un **alto xG** pero un **bajo PPG**. Esto sugiere que, aunque estos equipos han creado muchas oportunidades de gol, no han logrado obtener suficientes puntos. Podr√≠a ser indicativo de una ineficacia ofensiva o de la incapacidad de convertir esas oportunidades en goles.
4.  **Cuadrante Inferior Izquierdo (üö® Equipos en Dificultades)**:
    -   Equipos con **bajo xG** y **bajo PPG**. Estos equipos est√°n teniendo dificultades tanto para crear oportunidades de gol como para ganar puntos. Es probable que sean equipos con problemas en ambas √°reas y podr√≠an estar en riesgo de descender si no mejoran su rendimiento.

### An√°lisis de los resultados:

-   Los **equipos dominantes** en el cuadrante superior derecho (üî•) son aquellos que est√°n teniendo un gran rendimiento ofensivo y defensivo, y probablemente est√©n luchando por los primeros lugares en la liga.

-   Los **equipos en dificultades** (üö®) necesitan mejorar tanto en la ofensiva como en la defensiva. Si no cambian su rendimiento, pueden enfrentar serios problemas en la tabla de clasificaci√≥n.

-   Los **equipos sobrerendimiento defensivo** (‚öΩÔ∏è) han logrado buenos resultados a pesar de no generar muchas oportunidades. Esto podr√≠a indicar que est√°n defendiendo de manera muy efectiva o que han tenido suerte en sus partidos.

-   Los **equipos con ineficacia ofensiva** (‚ùå) est√°n creando muchas oportunidades pero no las est√°n aprovechando. Esto podr√≠a indicar que tienen una deficiencia en la finalizaci√≥n o en la toma de decisiones frente a la porter√≠a.

```{r xg_vs_ppg, echo=FALSE, fig.width=15, fig.height=10, message=FALSE}

# Calcular las medias de xG (goles esperados) y PPG (puntos por partido) para dividir los cuadrantes

xg_mean <- mean(team_stats$x_g)  # Media de los Goles Esperados (xG)
ppg_mean <- mean(team_stats$pts_mp)  # Media de los Puntos por Partido (PPG)

ggplot(team_stats, aes(x = x_g, y = pts_mp)) +
  # A√±adimos los 4 rect√°ngulos coloreados para resaltar los cuadrantes
  geom_rect(aes(xmin = -Inf, xmax = xg_mean, ymin = -Inf, ymax = ppg_mean), fill = "#ff8b94", alpha = 0.8) +  # Cuadrante inferior izquierdo
  geom_rect(aes(xmin = xg_mean, xmax = Inf, ymin = -Inf, ymax = ppg_mean), fill = "#fad7a0", alpha = 0.1) +  # Cuadrante inferior derecho
  geom_rect(aes(xmin = -Inf, xmax = xg_mean, ymin = ppg_mean, ymax = Inf), fill = "#33daff", alpha = 0.1) +  # Cuadrante superior izquierdo
  geom_rect(aes(xmin = xg_mean, xmax = Inf, ymin = ppg_mean, ymax = Inf), fill = "#80ff33", alpha = 0.1) +  # Cuadrante superior derecho
  
  # A√±adimos los puntos para cada equipo
  geom_point(size = 3) +  # Puntos de los equipos
  geom_image(aes(image = badge_image), size = 0.14) +  # Logos de los equipos
  
  # L√≠nea de tendencia para mostrar la relaci√≥n entre xG y PPG
  geom_smooth(method = "lm", col = "red") +  # L√≠nea de regresi√≥n
  
  # L√≠neas gu√≠a para dividir los cuadrantes
  geom_vline(xintercept = xg_mean, linetype = "dashed", color = "grey") +  # L√≠nea vertical en la media de xG
  geom_hline(yintercept = ppg_mean, linetype = "dashed", color = "grey") +  # L√≠nea horizontal en la media de PPG
  
  # A√±adimos los valores de las medias en las l√≠neas separadoras
  annotate("text", x = xg_mean, y = max(team_stats$pts_mp) + 0.3, label = paste("xG Medio: ", round(xg_mean, 2)), color = "black", size = 4, fontface = "italic", hjust = 0.5) +  # Valor de la media de xG (en la l√≠nea vertical)
  annotate("text", x = max(team_stats$x_g), y = ppg_mean, label = paste("PPG Medio: ", round(ppg_mean, 2)), color = "black", size = 4, fontface = "italic", hjust = 1, vjust = 0.5) +  # Valor de la media de PPG (en la l√≠nea horizontal)
  
  # A√±adimos las captions para cada cuadrante
  annotate("text", x = min(team_stats$x_g), y = max(team_stats$pts_mp) + 0.5, label = "‚öΩÔ∏è Sobrerendimiento defensivo", hjust = 0, vjust = 1, color = "blue", size = 5) +  # Cuadrante inferior izquierdo
  annotate("text", x = max(team_stats$x_g), y = max(team_stats$pts_mp) + 0.5, label = "üî• Equipos dominantes", hjust = 1, vjust = 1, color = "darkgreen", size = 5) +  # Cuadrante superior derecho
  annotate("text", x = min(team_stats$x_g), y = min(team_stats$pts_mp) - 0.5, label = "üö® Equipos en dificultades", hjust = 0, vjust = 0, color = "red", size = 5) +  # Cuadrante inferior izquierdo
  annotate("text", x = max(team_stats$x_g), y = min(team_stats$pts_mp) - 0.5, label = "‚ùå Ineficacia ofensiva", hjust = 1, vjust = 0, color = "orange", size = 5) +  # Cuadrante superior izquierdo
  
  # T√≠tulos y etiquetas de los ejes
  labs(title = "xG vs Puntos por Partido",
       x = "Goles Esperados (xG)",
       y = "Puntos por Partido") +
  theme_minimal()  # Tema minimalista

```

### Conclusi√≥n:

El an√°lisis de la relaci√≥n entre xG y Puntos por Partido (PPG) ofrece una perspectiva clave sobre la eficiencia y el rendimiento de los equipos en la Premier League. Los equipos dominantes (üî•) logran traducir su generaci√≥n de oportunidades en puntos, consolid√°ndose como contendientes al t√≠tulo.

Por otro lado, los equipos que sobrepasan las expectativas defensivamente (‚öΩÔ∏è) han conseguido buenos resultados sin generar muchas oportunidades de gol, lo que puede deberse a una defensa s√≥lida, una alta efectividad en la conversi√≥n de sus ocasiones o incluso factores externos como la suerte.

Los equipos con ineficacia ofensiva (‚ùå) muestran dificultades para transformar sus oportunidades en puntos, lo que podr√≠a indicar problemas en la finalizaci√≥n o en la toma de decisiones en el √°rea rival. Finalmente, los equipos en dificultades (üö®) enfrentan problemas tanto ofensivos como defensivos, lo que los coloca en una situaci√≥n delicada en la clasificaci√≥n.

Este gr√°fico permite no solo evaluar qu√© equipos est√°n rindiendo por encima o por debajo de las expectativas, sino tambi√©n prever posibles ajustes t√°cticos necesarios para mejorar su desempe√±o en el resto de la temporada.

------------------------------------------------------------------------

## Eficiencia Ofensiva vs Defensiva

El gr√°fico que se presenta a continuaci√≥n muestra la relaci√≥n entre la eficiencia ofensiva y defensiva de los equipos de la Premier League durante la temporada 2024/25. En este gr√°fico, se han utilizado dos m√©tricas clave para analizar el rendimiento de los equipos: **xG (goles esperados)** y **xGA (goles esperados en contra)**. Estas m√©tricas son fundamentales para evaluar c√≥mo un equipo genera oportunidades de gol y c√≥mo es capaz de evitar que su oponente marque.

### Explicaci√≥n de las m√©tricas:

-   **xG (Goles Esperados)**: Esta m√©trica mide la calidad de las oportunidades de gol creadas por un equipo. Un valor de xG m√°s alto indica que el equipo est√° generando oportunidades m√°s claras y peligrosas para marcar. Un equipo con un alto xG es probable que haya creado varias jugadas de peligro, pero no necesariamente haya marcado todos esos goles. Es un indicador de la eficacia ofensiva.

-   **xGA (Goles Esperados en Contra)**: Esta m√©trica mide la cantidad de goles que se espera que reciba un equipo, bas√°ndose en las oportunidades de gol generadas por el equipo contrario. Un valor bajo de xGA indica que un equipo est√° defendiendo bien y limitando las ocasiones de gol del adversario.

### C√≥mo leer el gr√°fico:

El gr√°fico est√° dividido en **4 cuadrantes**, basados en las medias de xG y xGA para todos los equipos de la Premier League en la temporada 2024/25:

1.  **Cuadrante superior izquierdo (üîµ Equipos Top)**:
    -   Equipos en este cuadrante tienen un **alto xG** (buena capacidad ofensiva) y un **bajo xGA** (buena capacidad defensiva).
    -   Estos equipos est√°n logrando crear muchas oportunidades de gol mientras limitan las oportunidades del oponente. Son los equipos m√°s equilibrados en t√©rminos de ataque y defensa, con un rendimiento consistente tanto en ofensiva como en defensa.
2.  **Cuadrante superior derecho (üü¢ Equipos Espectaculares)**:
    -   Equipos en este cuadrante tienen un **alto xG** pero tambi√©n un **alto xGA**.
    -   Estos equipos son muy fuertes en ataque, generando muchas oportunidades de gol, pero tambi√©n permiten muchas ocasiones a sus rivales. Son equipos que suelen ofrecer partidos muy emocionantes, con un alto n√∫mero de goles, pero su defensa podr√≠a ser vulnerable.
3.  **Cuadrante inferior izquierdo (üü° Equipos Defensivos)**:
    -   Equipos en este cuadrante tienen un **bajo xG** (pocas oportunidades de gol) y un **bajo xGA** (buena defensa).
    -   Estos equipos son muy s√≥lidos defensivamente, evitando que los rivales marquen goles, pero no generan muchas ocasiones claras para s√≠ mismos. Suelen ser equipos m√°s conservadores que priorizan la defensa sobre el ataque.
4.  **Cuadrante inferior derecho (üî¥ Equipos en Riesgo de Descenso)**:
    -   Equipos en este cuadrante tienen un **bajo xG** y un **alto xGA**.
    -   Estos equipos tienen problemas tanto en la ofensiva como en la defensiva. No generan muchas oportunidades de gol y, adem√°s, permiten muchas ocasiones al oponente. Este perfil es caracter√≠stico de equipos en riesgo de descenso, ya que tienen dificultades tanto para marcar goles como para defender.

### An√°lisis de los resultados:

-   Los **equipos m√°s equilibrados** suelen estar en el cuadrante superior izquierdo (üîµ), ya que no solo crean oportunidades, sino que tambi√©n limitan las del oponente. Estos equipos suelen estar en la parte superior de la tabla de clasificaci√≥n.

-   Los **equipos espectaculares** (üü¢), aunque son muy efectivos ofensivamente, deben mejorar su defensa para evitar partidos con demasiados goles en contra. Estos equipos son emocionantes para ver, pero podr√≠an ser vulnerables en partidos de alta presi√≥n.

-   Los **equipos defensivos** (üü°) priorizan la solidez en la defensa, pero su falta de creatividad ofensiva podr√≠a estar limitando su capacidad para ganar partidos. Estos equipos a menudo se concentran en evitar derrotas m√°s que en buscar victorias.

-   Los **equipos en riesgo de descenso** (üî¥) necesitan mejorar tanto en defensa como en ataque. Tienen serias dificultades para competir al m√°s alto nivel, ya que no generan oportunidades y, al mismo tiempo, permiten muchas ocasiones a sus rivales.

```{r xg_vs_xga, echo=FALSE, fig.width=15, fig.height=10}

# Calcular las medias de xG (goles esperados) y xGA (goles esperados en contra) para dividir los cuadrantes
mean_xg <- mean(team_stats$x_g, na.rm = TRUE)  # Media de goles esperados (xG)
mean_xga <- mean(team_stats$x_ga, na.rm = TRUE)  # Media de goles esperados en contra (xGA)

# Encontramos los valores m√≠nimos y m√°ximos de xG y xGA para posicionar las etiquetas (caption) de los cuadrantes
x_min <- min(team_stats$x_ga, na.rm = TRUE) - 2  # M√≠nimo valor de xGA con un peque√±o margen
x_max <- max(team_stats$x_ga, na.rm = TRUE) + 2  # M√°ximo valor de xGA con un peque√±o margen
y_min <- min(team_stats$x_g, na.rm = TRUE) - 8  # M√≠nimo valor de xG con un peque√±o margen
y_max <- max(team_stats$x_g, na.rm = TRUE) + 5  # M√°ximo valor de xG con un peque√±o margen

ggplot(team_stats, aes(x = x_ga, y = x_g, label = squad)) +

  # A√±adir los 4 rect√°ngulos coloreados para destacar los cuadrantes
  annotate("rect", xmin = -Inf, xmax = mean_xga, ymin = mean_xg, ymax = Inf, fill = "blue", alpha = 0.2) +  # Cuadrante: Equipos Top
  annotate("rect", xmin = mean_xga, xmax = Inf, ymin = mean_xg, ymax = Inf, fill = "green", alpha = 0.2) +  # Cuadrante: Equipos Espectaculares
  annotate("rect", xmin = -Inf, xmax = mean_xga, ymin = -Inf, ymax = mean_xg, fill = "yellow", alpha = 0.2) +  # Cuadrante: Equipos Defensivos
  annotate("rect", xmin = mean_xga, xmax = Inf, ymin = -Inf, ymax = mean_xg, fill = "red", alpha = 0.2) +  # Cuadrante: Equipos en Riesgo de Descenso

  # A√±adir las etiquetas (caption) de los cuadrantes en las esquinas extremas
  annotate("text", x = x_min, y = y_max, label = "üîµ Equipos Top", color = "blue", size = 5, fontface = "bold", hjust = 0, vjust = 1) +  # Cuadrante superior izquierdo
  annotate("text", x = x_max, y = y_max, label = "üü¢ Equipos Espectaculares", color = "darkgreen", size = 5, fontface = "bold", hjust = 1, vjust = 1) +  # Cuadrante superior derecho
  annotate("text", x = x_min, y = y_min, label = "üü° Equipos Defensivos", color = "orange", size = 5, fontface = "bold", hjust = 0, vjust = 0) +  # Cuadrante inferior izquierdo
  annotate("text", x = x_max, y = y_min, label = "üî¥ Equipos en Riesgo de Descenso", color = "red", size = 5, fontface = "bold", hjust = 1, vjust = 0) +  # Cuadrante inferior derecho

  # A√±adir los puntos para los equipos (con sus respectivas posiciones en xGA y xG)
  geom_point(size = 4, alpha = 0.8, color = "black") +

  # A√±adir las im√°genes de los logotipos de los equipos en lugar de las etiquetas de texto
  geom_image(aes(image = badge_image), size = 0.14) +  # Logos de los equipos

  # L√≠neas divisorias para separar los cuadrantes (l√≠neas punteadas)
  geom_vline(xintercept = mean_xga, linetype = "dashed", color = "gray") +  # L√≠nea vertical en la media de xGA
  geom_hline(yintercept = mean_xg, linetype = "dashed", color = "gray") +  # L√≠nea horizontal en la media de xG
  
  # A√±adir las etiquetas de las medias en las l√≠neas divisorias
  annotate("text", x = mean_xga, y = y_max + 1, label = paste("xGA Medio: ", round(mean_xga, 2)), color = "black", size = 4, fontface = "italic", hjust = 0.5) +  # Etiqueta en la l√≠nea vertical
  annotate("text", x = x_max - 5, y = mean_xg, label = paste("xG Medio: ", round(mean_xg, 2)), color = "black", size = 4, fontface = "italic", hjust = 0) +  # Etiqueta en la l√≠nea horizontal

  # T√≠tulos y etiquetas del eje
  labs(
    title = "Eficiencia Ofensiva vs Defensiva",  # T√≠tulo del gr√°fico
    x = "Goles Esperados en Contra (xGA) - Defensa",  # Etiqueta del eje X
    y = "Goles Esperados (xG) - Ataque"  # Etiqueta del eje Y
  ) +

  # Estilo minimalista para hacer el gr√°fico m√°s limpio
  theme_minimal()

```

### Conclusi√≥n:

El an√°lisis de la eficiencia ofensiva y defensiva nos ofrece una visi√≥n clara sobre las tendencias de juego de los equipos en la Premier League. Los equipos m√°s equilibrados (üîµ) combinan una alta capacidad ofensiva con una defensa s√≥lida, lo que les permite competir por los primeros puestos de la clasificaci√≥n.

Por otro lado, los equipos espectaculares (üü¢) destacan por su capacidad de generar ocasiones de gol, pero su fragilidad defensiva puede afectar su rendimiento en partidos clave. Los equipos defensivos (üü°) muestran solidez en la retaguardia, pero su falta de poder ofensivo podr√≠a limitar su √©xito a largo plazo. Finalmente, los equipos en riesgo de descenso (üî¥) enfrentan desaf√≠os tanto en ataque como en defensa, lo que compromete seriamente sus posibilidades de mantenerse en la liga.

Este gr√°fico no solo ayuda a comprender la identidad t√°ctica de cada equipo, sino que tambi√©n permite identificar √°reas de mejora clave que podr√≠an influir en su desempe√±o a lo largo de la temporada.

------------------------------------------------------------------------

## An√°lisis de la Posesi√≥n y Presi√≥n en el Campo

En esta secci√≥n se analiza c√≥mo los equipos de la Premier League distribuyen la posesi√≥n del bal√≥n y ejercen presi√≥n en diferentes zonas del campo, espec√≠ficamente en los tres tercios: defensivo, medio y ofensivo. La posesi√≥n y la presi√≥n son dos m√©tricas clave para comprender las t√°cticas de un equipo, ya que reflejan tanto su control del bal√≥n como su capacidad para presionar al oponente y recuperar el bal√≥n.

### Posesi√≥n en Cada Tercio del Campo

Se ha calculado el porcentaje de posesi√≥n de cada equipo en tres zonas espec√≠ficas del campo: la zona defensiva (`def_3rd`), la zona media (`mid_3rd`) y la zona ofensiva (`att_3rd`). El c√°lculo del porcentaje de posesi√≥n en cada zona se realiza mediante la siguiente f√≥rmula:

$$
\text{Porcentaje en zona} = \left( \frac{\text{Valor de la zona}}{\sum \text{de los valores de las tres zonas}} \right) \times 100
$$

Este an√°lisis nos permite entender c√≥mo se distribuye la posesi√≥n del bal√≥n a lo largo del campo. Un equipo que pasa m√°s tiempo en la zona ofensiva suele ser m√°s proactivo y dominante en el juego ofensivo. En contraste, un equipo que posee m√°s tiempo en su zona defensiva puede estar adoptando un estilo de juego m√°s conservador, defendiendo principalmente su √°rea.

### An√°lisis de la Presi√≥n

La presi√≥n ejercida por los equipos se eval√∫a en relaci√≥n con el tiempo de juego y la posesi√≥n. La presi√≥n se calcula como la intensidad con la que un equipo intenta recuperar el bal√≥n en cada tercio, y se normaliza de la siguiente manera:

$$
\text{Presi√≥n normalizada en zona} = \left( \frac{\text{Valor de la zona}}{\text{Minutos jugados}} \right) \times (100 - \text{Posesi√≥n})
$$

Este c√°lculo permite evaluar la intensidad de la presi√≥n en diferentes zonas del campo, teniendo en cuenta que un equipo que posee m√°s tiempo el bal√≥n puede presionar con mayor o menor intensidad en cada zona.

### Desviaci√≥n de la Presi√≥n Respecto al Promedio

Para comparar el comportamiento de un equipo en t√©rminos de presi√≥n con el promedio de la liga, calculamos la desviaci√≥n de la presi√≥n de cada zona en relaci√≥n al valor promedio de todos los equipos. La f√≥rmula para calcular esta desviaci√≥n es:

$$
\text{Desviaci√≥n de la presi√≥n} = \left( \frac{\text{Presi√≥n en zona}}{\text{Presi√≥n promedio en zona}} \right) \times 100 - 100
$$

La desviaci√≥n es categorizada en tres rangos:

- **Rojo**: Menos presi√≥n que el promedio.

- **Amarillo**: Presi√≥n similar al promedio.

- **Verde**: M√°s presi√≥n que el promedio.

Este an√°lisis permite identificar qu√© equipos est√°n presionando m√°s que la media en las distintas zonas del campo y qu√© equipos adoptan un enfoque m√°s pasivo.

### An√°lisis de los resultados:

A trav√©s del an√°lisis de la posesi√≥n y la presi√≥n, hemos podido observar algunas tendencias clave:

1. **Distribuci√≥n de la posesi√≥n**: Algunos equipos priorizan el control del bal√≥n en su zona ofensiva, lo que les permite dominar el juego y generar oportunidades de gol. Por otro lado, aquellos equipos con mayor posesi√≥n en su tercio defensivo tienden a adoptar un enfoque m√°s cauteloso.

2. **Intensidad de la presi√≥n**: Los equipos que presionan m√°s intensamente en la zona ofensiva suelen ser m√°s agresivos y orientados hacia la recuperaci√≥n r√°pida del bal√≥n. Los equipos con una presi√≥n m√°s baja, especialmente en la zona defensiva, tienden a mostrar una estrategia menos proactiva.

3. **Desviaci√≥n de la presi√≥n**: Algunos equipos sobresalen en t√©rminos de presi√≥n, superando el promedio de la liga. Esto indica que est√°n adoptando estrategias m√°s agresivas y enfocadas en la recuperaci√≥n de bal√≥n.

```{r pressure, echo=FALSE, fig.width=15, fig.height=10}
# Preparamos los datos de posesi√≥n a partir del dataset limpio
result <- prepare_possession_data(cleaned_team_possession)

# Extraemos los diferentes componentes del resultado
possession_data <- result$possession_data  # Datos generales de posesi√≥n
teams_press_pc_offset <- result$teams_press_pc_offset  # Desviaci√≥n de la presi√≥n ejercida por los equipos con respecto a la media
teams_poss_zone <- result$teams_poss_zone  # Distribuci√≥n de la posesi√≥n por zonas del campo

# Generamos el gr√°fico de posesi√≥n con los datos procesados
plot_possession_data(team_stats, teams_press_pc_offset, teams_poss_zone)

```

### Conclusiones

El an√°lisis de posesi√≥n y presi√≥n nos ha permitido identificar patrones t√°cticos clave en la Premier League. Los equipos con mayor posesi√≥n en el tercio ofensivo tienden a dominar el juego y generar m√°s oportunidades de gol, mientras que aquellos que mantienen la posesi√≥n en su zona defensiva adoptan un enfoque m√°s conservador.

En t√©rminos de presi√≥n, los equipos que ejercen una alta intensidad en el tercio ofensivo buscan recuperar el bal√≥n r√°pidamente y mantener un ritmo de juego agresivo. Por otro lado, equipos con menor presi√≥n en esta zona pueden priorizar una defensa m√°s organizada y compacta.

El an√°lisis de la desviaci√≥n de presi√≥n respecto al promedio de la liga ha revelado qu√© equipos adoptan estrategias m√°s agresivas y cu√°les optan por una aproximaci√≥n m√°s pasiva. Estos hallazgos pueden ser √∫tiles para evaluar tendencias t√°cticas, identificar fortalezas y debilidades de los equipos y comprender c√≥mo estas estrategias influyen en su rendimiento a lo largo de la temporada.

---
</div>